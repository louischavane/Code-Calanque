YUI.add("hermes-template-dialog-cta",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"ui-buttonbar-vertical"},3:function(e,t,n,r,i){var s;return'				<button class="ui-button ui-button-cta" data-action="confirm"><span>'+e.escapeExpression(e.lambda((s=t!=null?t.attrs:t)!=null?s.confirmButtonText:s,t))+"</span></button>\n"},5:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.buttonMarkup:t,{name:"if",hash:{},fn:e.program(6,i,0),inverse:e.program(8,i,0),data:i}))!=null?s:""},6:function(e,t,n,r,i){return"					"+e.escapeExpression(e.lambda(t!=null?t.buttonMarkup:t,t))+"\n"},8:function(e,t,n,r,i){var s;return'					<button class="ui-button" '+((s=n["if"].call(t!=null?t:{},t!=null?t.buttonAction:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:"")+"><span>"+e.escapeExpression(e.lambda(t!=null?t.buttonLabel:t,t))+"</span></button>\n"},9:function(e,t,n,r,i){return'data-action="'+e.escapeExpression(e.lambda(t!=null?t.buttonAction:t,t))+'"'},11:function(e,t,n,r,i){var s;return'				<button class="ui-button" data-action="decline"><span>'+e.escapeExpression(e.lambda((s=t!=null?t.attrs:t)!=null?s.cancelButtonText:s,t))+"</span></button>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=e.escapeExpression,u=t!=null?t:{};return'<div class="ui-dialog-wrapper ui-dialog ui-dialog-cta">\n	<h1 class="ui-dialog-title">'+o(e.lambda((s=t!=null?t.attrs:t)!=null?s.title:s,t))+'</h1>\n	<div class="ui-dialog-body">\n		<div class="ui-util-paragraph">\n			'+o((n.dialogOutlet||t&&t.dialogOutlet||n.helperMissing).call(u,t!=null?t.content:t,{name:"dialogOutlet",hash:{},data:i}))+'\n		</div>\n		<div class="ui-buttonbar '+((s=n["if"].call(u,(s=t!=null?t.attrs:t)!=null?s.verticalButtonList:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n'+((s=n.unless.call(u,(s=t!=null?t.attrs:t)!=null?s.hideConfirmButton:s,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+"			\n"+((s=n.each.call(u,(s=t!=null?t.attrs:t)!=null?s.additionalButtons:s,{name:"each",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+"			\n"+((s=n["if"].call(u,(s=t!=null?t.attrs:t)!=null?s.useCancelButton:s,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+"		</div>\n	</div>\n</div>\n\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/dialog-cta",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("dialog",function(e){"use strict";var t,n,r={},i=e.config.win,s=e.config.doc;t={css:{state:"c-state-{{state}}",hidden:"ui-util-hidden",loading:"ui-util-loading",working:"ui-util-working",locked:"ui-util-locked",complete:"ui-util-complete",removed:"ui-util-removed",content:"js-content",wrapper:"ui-dialog-wrapper",anchorSelected:"ui-util-selected",curtain:"ui-dialog-modal-curtain",curtainClear:"ui-dialog-modal-curtain-clear",arrow:"ui-dialog-arrow"},transitionTimeout:2e3,debug:!1},n=e.merge(e.flutil,{log:function(){var e=new Array(arguments.length);for(var r=0;r<e.length;++r)e[r]=arguments[r];if(!t.debug||!console.log.apply)return;e.unshift("DIALOG"),n.dump.apply(null,e)},propagateWrapperAttributes:function(e,n){var r=[],i;return!n||!n.getDOMNode()||!n.getDOMNode().classList?r:(Array.prototype.slice.call(n.getDOMNode().classList).forEach(function(i){if(i===t.css.wrapper)return;n.removeClass(i),e.addClass(i),r.push(i)}),i=n.getAttribute("data-action"),i&&(n.removeAttribute("data-action"),r.push({attr:"data-action",restore:e.getAttribute("data-action")||null}),e.setAttribute("data-action",i)),r)},rollbackWrapperAttributes:function(e,t){if(!t)return;for(var n=0,r=t.length;n<r;n++)typeof t[n]=="object"?t[1].restore?e.setAttribute(t[n].name,t[n].restore):e.removeAttribute(t[n].name):e.removeClass(t[n])}}),e.namespace("Views").dialog={_dialogs:{},getInstance:function(t,r){var i,s,o;return r.id?s={id:r.id}:(s=e.merge(r),delete s.parent,delete s.rootEl,delete s.template,delete s.appContext,typeof s.content=="object"&&s.content instanceof e.FlickrView?s.content=s.content.get("container").toString():typeof s.content=="function"?s.content=s.content({}):s.content.toString()),i="SGL"+n.createHashCode(s),o=this._dialogs[t+":"+i],o?o:this._new(t,i,r)},getNewInstance:function(e,t){var n="OBJ"+(Object.keys(this._dialogs).length+1)+(new Date).getTime();return this._new(e,n,t)},_new:function(t,n,i){var s,o,u,a,f;if(e.Env.isServer)throw new Error("Dialogs are client-only!");i=e.mix(i||{});if(i.parent)o=i.parent,delete i.parent,a=o.getContainer({subviewName:t,subviewParams:i}),u=o.appContext;else{if(!i.appContext)throw new Error('Either the "appContext" or "parent" parameter is required!');o=null,u=i.appContext,a=e.Node.create("<div/>"),a.addClass("view").addClass(t)}return i.appContext=u,i.container=a,s=new r[t](i),f=t+(n?":"+n:""),s._parent=o,this.registerView(s,f),this._navigateCloseHook||(this._navigateCloseHook=u.flapp.on("navigate",this.close.bind(this))),s},registerView:function(e,t){var n=this;t=t||"REG"+(Object.keys(this._dialogs).length+1),e.manager=this,this._dialogs[t]=e,e.on("destroy",function(){delete n._dialogs[t]})},hide:function(e){this.close(e,"hide")},close:function(e,t){var n=this,r;t=t||"close",typeof e=="string"?r=function(r){if(e!==r.split(/:/)[0])return;n._dialogs[r][t]()}:typeof e=="object"?r=function(r){if(e===n._dialogs[r])return;n._dialogs[r][t]()}:r=function(e){n._dialogs[e].get("autoCloseable")&&n._dialogs[e][t]()},Object.keys(this._dialogs).forEach(r)},isOpen:function(e){},util:n},e.namespace("Views").dialogs=r,r["dialog-base"]=e.Base.create("dialog-base",e.FlickrView,[],{initializer:function(e){return e=e||{},this.state={},this.manager=null,this.appContext=this.appContext||e.appContext,this},render:function(){var n=this.templates(this.get("template"))(this.toJSON());return this.setContainerHTML(n),e.namespace("Views").dialog.util.propagateWrapperAttributes(this.get("container"),this.get("container").one("."+t.css.wrapper)),this.renderContent(),this.activate(),this.get("container").addClass(t.css.hidden),this.anchorToLayout(),this.state.visible=!0,this.hide(),this.state.rendered=!0,this.fire("rendered"),this},renderContent:function(r){var i=this.get("content"),s=this.get("container"),o=s.one("."+t.css.content);e.namespace("Views").dialog.util.rollbackWrapperAttributes(this.get("container"),this._contWrap);if(i instanceof e.FlickrView){i=i.get("container");if(!i)throw new Error("The Content View doesn't have a container");o.setHTML(""),o.appendChild(i)}else i instanceof e.Node?(o.setHTML(""),o.appendChild(i)):typeof i=="function"?(i=i(e.merge(this.toJSON(),r)),o.setHTML(i)):typeof i=="string"&&this.state.rendered&&o.setHTML(i);this._contWrap=n.propagateWrapperAttributes(s,o.one("."+t.css.wrapper))},renderCurtain:function(){var n=this,r,i=e.Number.parse(this.get("tintCurtain"));this.get("curtain")||(r=e.Node.create("<div/>"),r.addClass(t.css.curtain).addClass(t.css.hidden),this.get("visibleShim")||r.addClass(t.css.curtainClear),r.on("click",this.dismiss,this),i&&r.setStyle("backgroundColor","rgba(0, 0, 0, "+i+")"),this.set("curtain",r),this.get("appendCurtainTo")?this.get("appendCurtainTo").appendChild(r):this.get("container").ancestor()&&this.get("container").ancestor().insert(r,"after")),n.get("curtain").removeClass(t.css.hidden)},anchorToLayout:function(){var t=this.get("container"),n=this.get("anchorTo"),r,i=this.get("appendTo")||n||this.get("rootEl");if(!i){var s=new Error("Missing DOM node for anchoring dialog.");throw window.beaconError("dialogjs.failure "+(this._parent?this._parent.name:""),e.config.win.location.href,s),s}i.appendChild(t),this.get("positioning")?(this.get("dropUp")&&(r="bottomright"),this.refreshPosition(r)):this.manualPosition()},refreshPosition:function(n){var r,s,o,u,a,f,l,c,h=this.get("container"),p=this.get("anchorTo"),d=this.get("offsetLeft")||0,v,m;u=h.getDOMNode().getBoundingClientRect(),this.set("width",h.getComputedStyle("width")),this.set("height",h.getComputedStyle("height")),h.getComputedStyle("position")==="fixed"&&h.setStyles({marginLeft:(-1*u.width/2|0)-d+"px",marginTop:(-1*u.height/2|0)+"px"});if(p){r=p.getDOMNode().getBoundingClientRect(),this.set("anchorWidth",r.width),this.set("anchorHeight",r.height),m=e.merge({top:0,bottom:0,left:0,right:0},this.get("constraints")),c={top:m.top,bottom:i.innerHeight+m.bottom,left:m.left,right:i.innerWidth+m.right},a=[[r.bottom+u.height<c.bottom&&r.right+u.width<c.right,{left:0,top:r.height},"topleft"
],[r.bottom+u.height<c.bottom&&r.left-u.width>c.left,{right:0,top:r.height},"topright"],[r.top>u.height+c.top&&r.right+u.width<c.right,{left:0,bottom:r.height},"bottomleft"],[r.top>u.height+c.top&&r.left-u.width>c.left,{right:0,bottom:r.height},"bottomright"],[!0,{left:Math.round(-1*(u.width-r.width)/2),top:r.height},"topcenter"]],n&&(n=n.toLowerCase(),a=a.filter(function(e){return e[2]===n?(e[0]=!0,!0):!1})||a);while(a.length){l=a.shift();if(l[0]){f=l[1],h.addClass("ui-dialog-tooltip-witharrow-"+l[2]),h.setStyles(e.mix({top:"auto",bottom:"auto",left:"auto",right:"auto"},f,!0));break}}v=h.one("."+t.css.arrow),v&&(s=20,f.left!==0&&f.right!==0?o=Math.round((u.width-s)/2)+"px":o=Math.round((r.width-s)/2)+"px",v.setStyles({right:f.right===undefined?"auto":o,left:f.left===undefined?"auto":o}))}},manualPosition:function(){if(this.get("arrow")){var e=typeof this.get("arrow")=="string"?this.get("arrow"):"topleft";this.get("container").addClass("ui-dialog-tooltip-witharrow-"+e)}},activate:function(){var e={":confirm":this.confirm,":decline":this.decline,":dismiss":this.dismiss,":ok":this.dismiss,":halt":function(e){e.halt()}};return this.attachEvents(e),this},toJSON:function(){var t=this.getAttrs();return Object.keys(t).reduce(function(n,r){var i=t[r];return i instanceof e.Node?n:i instanceof e.FlickrView?n:(i&&i.toJSON&&(i=i.toJSON()),n[r]=i,n)},{})},isVisible:function(){return!!this.state.visible},isLocked:function(){return!!this.state.locked},isWorking:function(){return!!this.state.working},show:function(r){try{var i=this,s=this.get("container"),o=this.get("anchorTo");this.set("dismissing",!1),this.switchToLoading(!1);if(this.state.visible)return;this.state.rendered||this.render(),i.state.visible=!0,s.addClass(this.get("dialogClass")),this.fire("show"),s.removeClass(t.css.removed),setTimeout(function(){n.onTransitionEnd(s,r),s.removeClass(t.css.hidden),o&&o.addClass(t.css.anchorSelected)},10),e.fire("flickr:setKeyEventScope",this.getKeyEventScope())}catch(u){console&&console.error&&console.error("An error occured showing the dialog.")}},handleError:function(e){return function(t){console.error(e,!t.toString||t.toString().match(/^\[object/)?t:t.toString())}},getKeyEventScope:function(){return this.name+this._yuid},close:function(e){if(this._destroyed)return;var t=this;this.set("dismissing",!1),this.fire("close"),this.hide(function(){t.destructor(),e&&e()})},destructor:function(){var t=this.get("container");t.detach(),t.remove(),this.set("container",null),this.set("content",null),this.set("appendTo",null),this.set("anchorTo",null),this.set("rootEl",null),this.set("dialogClass",null),this.manager=null,e.FlickrView.prototype.destroy.call(this),this._destroyed=!0,this.fire("destroy"),this.detachAll()},hide:function(r){e.fire("flickr:removeKeyEventScope",this.getKeyEventScope());if(!this.state.visible)return;var i=this,s=this.get("container"),o=this.get("anchorTo"),u=this.get("curtain"),a=!this.state.rendered;this.state.visible=!1,o&&o.removeClass(t.css.anchorSelected),u?(this.set("curtain",null),u.detach(),this.get("dismissCurtainImmediately")?(u.addClass(t.css.hidden),u.remove()):(n.onTransitionEnd(u,function(){u.remove()}),u.addClass(t.css.hidden))):s.addClass(t.css.removed),e.namespace("Views").dialog.util.onTransitionEnd(s,function(){i.set("dismissing",!1),a||i.fire("hide"),i.state.visible||s.addClass(t.css.removed),r&&r()}),s.addClass(t.css.hidden)},toggle:function(e){this[this.state.visible?"hide":"show"](e),this.fire("toggle",this.state.visible)},switchToLoading:function(e){this.switchToUIState("loading",e)},switchToComplete:function(e){this.switchToUIState("complete",e)},switchToLocked:function(e){this.switchToUIState("locked",e)},switchToWorking:function(e){this.switchToUIState("working",e)},switchToUIState:function(e,n){var r;n=n===!1?!1:!0;if(this.state[e]===n)return;this.state[e]=n,r=t.css[e]||t.css.state.replace(/\{\{state\}\}/,e),this.get("container")[n?"addClass":"removeClass"](r)},confirm:function(t,n){t.halt(),this.fire("confirm",n),this.get("hideOnButtonClick")&&this.hide(),e.namespace("Views").dialog.util.log("CONFIRM")},decline:function(t,n){t.halt(),this.fire("decline",n),this.get("hideOnButtonClick")&&this.hide(),e.namespace("Views").dialog.util.log("DECLINE")},dismiss:function(t,n){if(this.isWorking()||!this.get("hideOnCurtainClick"))if(t.target===this.get("curtain"))return;this.set("dismissing",!0),t.halt(),this.fire("dismiss",n),this.hide(),e.namespace("Views").dialog.util.log("DISMISS")}},{ATTRS:{template:{value:"dialog"},anchorTo:{value:null},offsetLeft:{value:0},appendTo:{value:null},appendCurtainTo:{value:null},hideOnCurtainClick:{value:!0},tintCurtain:{value:0},rootEl:{value:e.Node&&e.one(s&&s.body)},content:{value:null},attrs:{value:{}},stack:{value:!1},hideOnButtonClick:{value:!0},visibleShim:{value:!0},positioning:{value:!0},arrow:{value:!1},dropUp:{value:!1},constraints:{value:{}},dialogClass:{value:""},autoCloseable:{value:!0},dismissCurtainImmediately:{value:!1}}}),r["dialog-tooltip"]=e.Base.create("dialog-tooltip",r["dialog-base"],[],{show:function(){this.get("stack")||this.manager&&this.manager.close&&this.manager.close(this),r["dialog-base"].prototype.show.apply(this,arguments),this.renderCurtain()}},{ATTRS:{template:{value:"dialog-tooltip"},offsetLeft:{value:0},visibleShim:{value:!1}}}),r["dialog-modal"]=e.Base.create("dialog-modal",r["dialog-base"],[],{anchorToLayout:function(){this.set("anchorTo",null),r["dialog-base"].prototype.anchorToLayout.apply(this,arguments)},show:function(e,t){var n=t||{},i=n.hideOthers||!1;i?this.get("stack")||this.manager.hide(this):this.get("stack")||this.manager.close(this),r["dialog-base"].prototype.show.call(this,e),this.renderCurtain()}},{ATTRS:{template:{value:"dialog-modal"}}}),r["dialog-alert"]=e.Base.create("dialog-alert",r["dialog-base"],[],{show:function(){this.get("stack")||this.manager.close(this),r["dialog-base"].prototype.show.apply(this,arguments),this.renderCurtain()}},{ATTRS:{template:{value:"dialog-alert"},offsetLeft
:{value:0},visibleShim:{value:!1}}}),r["dialog-cta"]=e.Base.create("dialog-cta",r["dialog-base"],[],{show:function(){this.get("stack")||this.manager.close(this),r["dialog-base"].prototype.show.apply(this,arguments),this.renderCurtain()},hide:function(){this.get("curtain")&&(this.get("curtain").remove(),this.set("curtain",null)),r["dialog-base"].prototype.hide.apply(this,arguments)}},{ATTRS:{template:{value:"dialog-cta"},offsetLeft:{value:0},visibleShim:{value:!1}}}),r["dialog-progress"]=e.Base.create("dialog-progress",r["dialog-base"],[],{},{ATTRS:{template:{value:"dialog-progress"}}}),e.Handlebars.registerHelper("dialogOutlet",function(n){var r=['<div class="'+t.css.content+'">'];return n instanceof e.FlickrView||n instanceof e.Node?r.push("<!--"+(n.name||"DOM-node")+"-->"):r.push((n||"")+""),r.push("</div>"),new e.Handlebars.SafeString(r.join(""))})},"@VERSION@",{requires:["flickr-view","handlebars-base","flutil","hermes-template-dialog-tooltip","hermes-template-dialog-modal","hermes-template-dialog-alert","hermes-template-dialog-cta","flickrui-css"]});
YUI.add("basic-book-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{title:{},owner:{},coverPhoto:{isModel:!0},coverPhotoDeleted:{defaultFn:function(){return!1}},cropW:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropH:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropX:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropY:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},totalPages:{},created:{getter:function(e){return parseInt(e,10)}},updated:{getter:function(e){return parseInt(e,10)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-updateBook-updater","flickr-products-books-editBook-updater"]});
YUI.add("flickr-creations-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=[],d=[],v=[];return r&&r.stat==="ok"&&(p=Object.keys(r.wallart_ids).map(function(e){return r.wallart_ids[e]}),e.Array.each(p,function(t,n){if(t.photoSource===2)return;var r,i,s,u=[],p=!1,v,m,g,y={};r=a.addOrUpdate({id:t.owner}),t.photo.id?(y={photos:[t.photo],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c,photoCurationModelRegistry:h},t.photo.ownerId&&(y.ownerID=t.photo.ownerId),i=e.APIHelper.response.parsePhotos(y)[0]):p=!0,t.orders&&typeof t.orders=="object"&&(s=Object.keys(t.orders).map(function(e){return t.orders[e]}),e.Array.each(s,function(e){u.push({orderId:e.orderId,orderStatus:e.order.statusOrder,dateCreate:e.dateCreate,dateUpdate:e.dateUpdate})})),t.skuId.substr(-2)==="CC"?(v=t.skuId.slice(0,-3),m=!0):t.skuId.substr(-2)==="MK"?(v=t.skuId.slice(0,-3),g=!0):v=t.skuId,d.push(o.addOrUpdate({id:t.wallartId,owner:r,photo:i,photoDeleted:p,skuId:v,isCC:m,isMK:g,orientation:t.orientation,price:t.price,cropW:t.photo.cropW,cropH:t.photo.cropH,cropX:t.photo.cropX,cropY:t.photo.cropY,isEditable:t.isEditable,isLowQuality:t.isLowQuality,created:t.dateCreate,updated:t.dateUpdate,orders:u,photoSource:t.photoSource}))})),i&&i.stat==="ok"&&e.Array.each(i.books.book,function(t,n){var r=!1,i,s;i=a.addOrUpdate({id:t.owner}),t.coverPhoto.id?s=e.APIHelper.response.parsePhotos({photos:[t.coverPhoto],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c})[0]:r=!0,v.push(u.addOrUpdate({id:t.id,title:t.title,owner:i,coverPhoto:s,coverPhotoDeleted:r,totalPages:t.countPages,created:t.dateCreate,updated:t.dateUpdate,cropW:t.coverPhoto.cropW/100,cropH:t.coverPhoto.cropH/100,cropX:t.coverPhoto.cropX/100,cropY:t.coverPhoto.cropY/100}))}),s.addOrUpdate({id:n.id,wallarts:d,books:v}),{wallarts:d,books:v}}function i(n,r){var i=this,s=this._processParams(n);return e.Promise.all([r.callAPI("flickr.products.wallart.getList",s,!0),r.callAPI("flickr.products.books.getList",s,!0),r.getModelRegistry("creations-models"),r.getModelRegistry("wallart-models"),r.getModelRegistry("basic-book-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-creations"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["creations-models","wallart-models","basic-book-models","person-models","photo-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("creations-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-creations"].run(t,this.appContext)}},removeCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").remove(e)}),n.books&&e.Array.each(n.books,function(e,n){r.getValue(t,"books").remove(e)})},appendCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").unshift(e)})},attributes:{wallarts:{isCollection:!0},books:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-promise","model-proxy","flickr-model-registry","flickr-creations-fetcher"],optional:["wallart-models","basic-book-models"]});
YUI.add("flickr-products-wallart-create-creator",function(e,t){"use strict";function r(e){var t={};return e=e||{},t.photo_id=e.photoId,t.sku_id=e.skuId,t}function i(e,t,r){var i=e[0],s=e[1],o=e[2],u=e[3],a=t.nsid,f,l,c,h,p=!1,d=!1,v=e[4],m,g;return i?(f=i.wallart,c=o.exists(a)?o.proxy(a):o.add({id:a}),l=u.exists(t.photoId)?u.proxy(t.photoId):u.add({id:t.photoId}),f.skuId.substr(-2)==="CC"?(h=f.skuId.slice(0,-3),p=!0):f.skuId.substr(-2)==="MK"?(h=f.skuId.slice(0,-3),d=!0):h=f.skuId,s.exists(f.wallartId)?(s.setValues(f.wallartId,{owner:c,photo:l,skuId:h,isCC:p,isMK:d,orientation:f.orientation,photoSource:f.photoSource}),g=s.proxy(f.wallartId)):g=s.add({id:f.wallartId,owner:c,photo:l,skuId:h,isCC:p,isMK:d,orientation:f.orientation,created:f.dateCreate,photoSource:f.photoSource}),v.exists(a)&&(m=v.proxy(a),m.appendCreations({wallarts:[s.proxy(f.wallartId)]}))):(n.warn("No API response?"),g=this),g}function s(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.wallart.create",this._processParams(n)),r.getModelRegistry("wallart-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("creations-models")]).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}var n=require("lib/flog")(t);e.namespace("ModelCreators")["flickr-products-wallart-create"]={run:s,_processParams:r,_processResponse:i}},"@VERSION@",{requires:["flickr-promise","wallart-models"],optional:["person-models","photo-models","creations-models"]});
YUI.add("flickr-products-wallart-editWallart-updater",function(e,t){"use strict";function n(e,t,n){var r=e.response,i=e.wallartModelRegistry;i.exists(t)&&i.setValue(t,"price",r.wallart.price);if(this.pendingUpdate)return this.pendingUpdate=!1,this.startNextUpdate(t,n)}function r(e,t){return t.getModel("wallart-models",e).then(function(e){var t,n,r,i,s;return n=e.getValue("photo"),i=e.getValue("isCC"),s=e.getValue("isMK"),r=e.getValue("skuId"),i===!0?r+="_CC":s===!0&&(r+="_MK"),t={wallart_id:e.id,photo:{id:n.getValue("id"),owner:n.getValue("owner").getValue("id"),crop_x:e.getValue("cropX"),crop_y:e.getValue("cropY"),crop_h:e.getValue("cropH"),crop_w:e.getValue("cropW")},sku_id:r,orientation:e.getValue("orientation"),is_low_quality:e.getValue("isLowQuality")},{wallart:JSON.stringify(t)}})}function i(n,r){var i=this;return this.serialize(n,r).then(function(s){return(new e.FlickrPromise({response:r.callAPI("flickr.products.wallart.update",s),wallartModelRegistry:r.getModelRegistry("wallart-models")})).then(function(e){return i.processResponse(e,n,r)},function(e){throw i.pendingUpdate&&(i.pendingUpdate=!1),e}).then(null,e.FetcherErrorLogger(t))})}function s(){return this.updateInFlight=null,!0}function o(e,t){return this.updateInFlight=this.callAPI(e,t).then(this.clearUpdateInFlight.bind(this),this.clearUpdateInFlight.bind(this)),this.updateInFlight}function u(e,t){return this.pendingUpdate=null,this.startUpdate(e,t)}function a(e,t){return this.pendingUpdate?this.updateInFlight:this.updateInFlight?(this.pendingUpdate=!0,this.updateInFlight):this.startUpdate(e,t)}e.namespace("ModelUpdaters")["flickr-products-wallart-editWallart"]={run:a,serialize:r,callAPI:i,clearUpdateInFlight:s,startUpdate:o,processResponse:n,startNextUpdate:u}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("wallart-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-products-wallart"].run(t,this.appContext)},create:function(t){return e.ModelCreators["flickr-products-wallart-create"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-products-wallart-editWallart"].run(t,this.appContext)}},attributes:{owner:{isModel:!0},photo:{isModel:!0},photoDeleted:{defaultFn:function(){return!1}},isCC:{defaultFn:function(){return!1}},isMK:{defaultFn:function(){return!1}},photoSource:{},skuId:{},orientation:{},price:{},cropW:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},cropH:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},cropX:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},cropY:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},isLowQuality:{defaultFn:function(){return 0}},isEditable:{defaultFn:function(){return!0}},isDeleted:{defaultFn:function(){return!1}},invalidForPrintReason:{},isInvalidForPrint:{},created:{getter:function(e){return parseInt(e,10)}},updated:{getter:function(e){return parseInt(e,10)}},orders:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-wallart-fetcher","flickr-products-wallart-create-creator","flickr-products-wallart-editWallart-updater"]});
YUI.add("flickr-products-wallart-fetcher",function(e,t){"use strict";function n(t){var n={wallart_id:t.id,return_deleted:1,extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=r.wallart,c,h,p,d,v=!1,m=!1,g={};if(l)return p=s.addOrUpdate({id:l.owner}),g={photos:[l.photo],personModelRegistry:s,photoModelRegistry:o,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f},l.photo.ownerId&&(g.ownerID=l.photo.ownerId),h=e.APIHelper.response.parsePhotos(g)[0],l.skuId.substr(-2)==="CC"?(d=l.skuId.slice(0,-3),v=!0):l.skuId.substr(-2)==="MK"?(d=l.skuId.slice(0,-3),m=!0):d=l.skuId,c={id:l.wallartId,owner:p,photo:h,skuId:d,isCC:v,isMK:m,orientation:l.orientation,price:l.price,cropW:l.photo.cropW,cropH:l.photo.cropH,cropX:l.photo.cropX,cropY:l.photo.cropY,isEditable:l.isEditable,isDeleted:l.isDeleted,isLowQuality:l.isLowQuality,photoSource:l.photoSource,created:l.dateCreate},i.addOrUpdate(c),c}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.wallart.getDetails",this._processParams(n)),r.getModelRegistry("wallart-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-products-wallart"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["wallart-models","photo-models","person-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("photo-engagement-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.signinPendingQueue=e.signinPendingQueue,this},subviewConfig:{"fave-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,hideWhoFaved:!0},"photo-well-scrappy-edit-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-share-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){var e=this.get("photo"),t=e.getValue("owner"),n=e.getValue("isMarketplaceLicensable")&&this.appContext.flipper.getValue("licensing-button-placement")==="toolbar",r;return r={"share-view":this.subviews["fluid-share-photo-view"]?this.subviews["fluid-share-photo-view"].get("container"):"",photoId:e.getValue("id"),ownerId:e.getValue("owner").getValue("id"),isVideo:e.getValue("isVideo"),viewerIsOwner:t.getValue("isMe"),canCreateWallart:this.canCreateWallart(),isWallartLowQuality:this.isWallartLowQuality(),downloadingAvailable:!1,downloadLink:"",showLicenseButton:n,marketplaceLicensingUrl:e.getValue("marketplaceLicensingUrl")},e.getValue("isVideo")?(r.downloadLink="/video_download.gne?id="+e.getValue("id"),this.appContext.flipper.isFlipped("enable-album-download")&&(r.downloadingAvailable=e.getValue("engagement").getValue("canDownload")),t.getValue("isMe")&&(r.downloadingAvailable=!0)):(r.downloadLink=e.getValue("url")+"/sizes/l/",r.downloadingAvailable=!0),this.appContext.forceServerRender&&(r.downloadItems=this.getDownloadMenuItems()),this.setContainerWithTemplate("photo-engagement",r),r.canCreateWallart&&this.get("container").addClass("has-wallart"),n&&this.get("container").addClass("has-buyable"),this},buildErrorContainer:function(){this.setContainerHTML("")},activate:function(){var e=this.get("photo").getValue("license"),t=e!==0&&e!==7&&e!==8&&e!==10,n=e===8,r=e===9,i=e===10,s=this.get("container");if(this.signinPendingQueue&&this.signinPendingQueue.length>0){var o=this.signinPendingQueue;for(var u=0;u<o.length;u++)o[u].key==="download"&&o[u].value&&o[u].value.id===this.photoId&&this.downloadItem(o[u].value.imageUrl)}return this.appContext.flipper.isFlipped("enable-signed-out-download-cta-test")&&!this.appContext.getViewer().signedIn&&!this.appContext.getUA().isBot&&this.get("photo").getValue("owner").getValue("isPro")!==!0&&!t&&!n&&!r&&!i&&this.get("photo").getValue("visibilitySource")!==2&&(this.signedOutTest=!0),this.createDownloadDialog(this.getDownloadMenuItems()),this.registerEventHandler(s.all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this)),this.attachKeyEvent("down:68",this.handleDownloadMenuButtonClick.bind(this)),this.registerEventHandler(s.delegate("click",this.handleDownloadMenuButtonClick.bind(this),".download a")),this.registerEventHandler(s.delegate("click",this.createWallartClick.bind(this),".wallart a")),this.registerEventHandler(this.get("photo").on("valuesChanged",function(e){e.isMarketplacePrintable&&e.isMarketplacePrintable.newVal===!0&&(this.buildContainer(),this.getDownloadMenuItems(),this.get("container").all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this))}.bind(this))),this.signedOutTest&&this.registerEventHandler(s.one(".all-sizes").on("click",function(e){e.halt(),this.signUpAndDownloadItem()}.bind(this))),this.appContext.flipper.isFlipped("display-marketplace-licensable")&&s.one(".photoListLicenseButton")&&(this.registerEventHandler(s.one(".photoListLicenseButton").on("click",this.licenseButtonClick,this)),this.registerEventHandler(s.one(".photoListLicenseButton").on("mouseenter",this.licenseButtonHover,this)),this.registerEventHandler(s.one(".photoListLicenseButton").on("mouseleave",this.licenseButtonHover,this))),this},licenseButtonHover:function(t){var n=300;t.halt();var r=t.type,i=this;if(r==="mouseenter"){if(e.StorageHelper.getItem("seenThirdParty"))return;this.tooltip&&this.tooltip.close(),clearTimeout(this.tooltipHoverTimer),this.isHovering=!0,this.tooltipHoverTimer=setTimeout(function(){i.isHovering&&(i.tooltip=new e.Views.FluidDroparound({appContext:i.appContext,showDropArrow:!0,dismissOnOverlayClick:!1,dismissOnActionClick:!1,observePageResize:!0,anchorElement:t.target,positionFixed:!0,closeOnScroll:!0,hideModalOverlay:!0,invisibleOverlay:!0,autoSizeToContent:!0,useAnchorOffsetSize:!0,horizCenterToAnchor:!0,preferTop:!0,classList:"photo-license-pop-up",textMessage:i.intlMessage({intlName:"common.CLICK_BUTTON_THIRD_PARTY"})}),i.tooltip.show())},n)}else this.isHovering=!1,this.tooltip&&this.tooltip.close()},licenseButtonClick:function(t){var r={owner_id:t.target.getData("ownerid"),photo_id:t.target.getData("photoid")};this.appContext.callAPI("flickr.licensing.marketplace.addClick",r).then(function(){e.StorageHelper.setItem("seenThirdParty",1)},function(e){n.error("flickr.licensing.marketplace.addClick failed",{photoId:r.photo_id})})},canCreateWallart:function(){var e=!1,t,n=this.appContext.getViewer(),r,i,s,o,u;return t=this.get("photo"),t&&n&&(i=!1,r=t.getValue("owner").getValue("isMe"),s=t.getValue("isMarketplacePrintable"),u=t.getValue("safetyLevel")===0,o=!t.getValue("isVideo"),this.appContext.flipper.isFlipped("creative-commons-wallart")?r?this.appContext.getViewer().signedIn&&o&&(e=!0):i?this.appContext.getViewer().signedIn&&o&&u&&(e=!0):s&&this.appContext.getViewer().signedIn&&o&&u&&(e=!0):this.appContext.getViewer().signedIn&&r&&o&&(e=!0)),e},isWallartLowQuality:function(){var t=this.get("photo");return this.wallartHelper||(this.wallartHelper=new e.WallartHelper),this.wallartHelper.isPhotoWallartable(t).skus.length===0?!0:!1},createWallartClick:function(n){var r=this,i="/create/wallart/",s=this.get("photo"),o;n.halt(),e.rapidTracker
.beacon(t,"createWallartClick");if(s.getValue("hasInvalidColorspaceForPrint"))return this.handleLacksWallartability("COLORSPACE");this.wallartHelper||(this.wallartHelper=new e.WallartHelper(this.appContext));if(this.wallartHelper.isPhotoWallartable(s).skus.length===0)return this.handleLacksWallartability("LOW_QUALITY");this.appContext.getModelRegistry("wallart-models").then(function(t){t.remoteCreate({nsid:r.appContext.getViewer().nsid,photoId:s.getValue("id")}).then(function(t){i+=t.getValue("id")+"/edit",YUI.Env.isServer||(!r.appContext.secure&&window.location.host===e.config.flickr.url.host?e.config.win.location.href=i:r.appContext.flapp.navigate(i))},function(t){o=new e.Views.FluidModal({appContext:r.appContext,darkOverlay:!0,dismissOnOverlayClick:!0,actionButtonLabel:r.intlMessage({intlName:"common.OK"}),title:r.intlMessage({intlName:"common.UPLOAD_ERROR_TITLE"}),message:"There was a problem creating your wall art. Please try again later."}),o.show()})})},handleLacksWallartability:function(t){var n,r;t==="LOW_QUALITY"?r="Looks like this photo doesn't meet the minimum requirements to get printed. Please choose a photo that's at least 975 &times; 825 pixels. Learn more about <a href='http://help.yahoo.com/kb/index?page=content&y=PROD_FLICKR&locale=en_US&id=SLN22567'>requirements</a> for print products.":t==="COLORSPACE"&&(r="Sorry, we cannot print photos with a CMYK or ProPhoto RGB colorspace. We recommend photos with an sRGB color space. <a href='https://help.yahoo.com/kb/flickr/creations-faq-sln22216.html?impressions=true#cont33'>Learn more</a>."),n=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,showCancelX:!0,title:"Try a different photo",message:r,classList:"lacks-wallartability"}),n.show()},getDownloadMenuItems:function(t){var n=e.clone(this.get("photo").toJSON()),r,i=[],s,o=this.get("photo").getValue("engagement").getValue("canDownload"),u=!1;if(!n||!n.sizes)return"";n.sizes.q&&(n.sizes.q.label=this.intlMessage({intlName:"photo-page-scrappy.SQUARE"}),i.push(n.sizes.q)),n.sizes.s&&(n.sizes.s.label=this.intlMessage({intlName:"photo-page-scrappy.SMALL"}),i.push(n.sizes.s)),n.sizes.z&&(n.sizes.z.label=this.intlMessage({intlName:"photo-page-scrappy.MEDIUM"}),i.push(n.sizes.z)),n.sizes.k?(n.sizes.k.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),i.push(n.sizes.k)):n.sizes.h?(n.sizes.h.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),i.push(n.sizes.h)):n.sizes.l&&(n.sizes.l.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),i.push(n.sizes.l)),n.sizes.o&&(n.sizes.o.label=this.intlMessage({intlName:"photo-page-scrappy.ORIGINAL"}),i.push(n.sizes.o));for(s=0;s<i.length;s++)i[s].url=i[s].displayUrl.replace(/^(.+)(\..+)$/,"$1_d$2");return o&&(u=!0),r=this.templates("scrappy-download-menu")({photo:n,sizes:i,showDownloadSizes:u}),r},createDownloadDialog:function(t){var n=this.get("container"),r=this;this.downloadMenu=e.Views.dialog.getNewInstance("dialog-tooltip",{content:t,anchorTo:n.one(".download"),dropUp:!0,parent:this,positioning:!1,rootEl:n}),this.downloadMenu.render(),this.downloadMenu.on("toggle",function(e){e&&e.details&&e.details.length>0&&(e.details[0]?r.fire("subviewViewEvent","make in view",n):r.fire("subviewViewEvent","close in view"))})},handleDownloadMenuButtonClick:function(n){var r=this.get("photo"),i;if(n.target.ancestor(".download",!0).hasClass("disabled"))n.preventDefault();else if(r.getValue("isVideo"))if(!this.appContext.flipper.isFlipped("enable-album-download")){i=r.getValue("owner").getValue("isMe");if(!i)return n.preventDefault(),!1}else this.handleDownloadItemClick(n);else n.halt(),this.downloadMenu.toggle();e.rapidTracker.beacon(t,"downloadDialogClick")},handleDownloadItemClick:function(n){n.preventDefault();var r;r=n.currentTarget.getAttribute("href"),this.signedOutTest?this.signUpAndDownloadItem(r):this.downloadItem(r),e.rapidTracker.beacon(t,"photoDownloadClick"),this.downloadMenu.hide()},downloadItem:function(e){document.location=e},signUpAndDownloadItem:function(t){var n=this,r=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_TITLE"}),i=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_MESSAGE"}),s,o;this.get("photo").getValue("isVideo")&&this.appContext.lang.toLowerCase()==="en-us"&&(r=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_VIDEO_TITLE"})),s=e.url(e.URLHelper.getPhotoPage({photoId:this.photoId,pathAlias:this.nsid})),o=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-download",signUpTitle:r,signUpMessage:i,beaconPrefix:"download"}),o.on("signUpClick",function(r){t?e.SigninHelper.signUpPendingDownload({id:n.photoId,imageUrl:t},{postLoginUrl:s}):e.SigninHelper._redirectToSignUp("download",{postLoginUrl:s+"sizes/l/"})}),o.on("signInClick",function(r){t?e.SigninHelper.addPendingDownload({id:n.photoId,imageUrl:t},{postLoginUrl:s}):e.SigninHelper._redirectToSignin("download",{postLoginUrl:s+"sizes/l/"})}),o.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-engagement","hermes-template-scrappy-download-menu","wallart-helper","photo-engagement-css","signup-modal-view","fluid-share-photo-view","fluid-droparound-view","better-throttle","dialog"],optional:["photo-models","wallart-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("seo",function(e,t){e.Seo={appContext:{},getSEOTitleForPhoto:function(e,t,n,r){var i=e.getValue("og:title"),s=e.getValue("og:description"),o="",u="| Flickr",a=70,f=a-(i.length+u.length+5);return i==="Untitled"&&(i=r),i.length>50?o=i.slice(0,58)+(i.length<58?" ":"\u2026 "):i.length>20&&i.length<50?s.length>20?o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 "):o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 ")+"| "+n+" ":i.length<=20&&(s.length>50?o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 "):o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 ")+"| "+n+" "),o},generateSEODescriptionForPhoto:function(e,t,n,r,i){var s=e.getValue("og:title"),o=e.getValue("og:description"),u="",a=160;return s==="Untitled"&&(s=r),o.length>120?u=o.slice(0,120)+(o.length<120?" ":"\u2026 ")+n+" "+i+".":o.length>60&&o.length<120?u=o+(o.slice(o.length-1,o.length)==="."?" ":". ")+s.slice(0,40)+(s.length<40?" ":"\u2026 ")+n+" "+i+".":o.length<=60&&(u=s+(s.slice(s.length-1,s.length)==="."?" ":". ")+o.slice(0,a-s.length)+(o.length<a-s.length?" ":"\u2026 ")+n+" "+i+"."),u}}},"@VERSION@",{requires:[]});
YUI.add("hermes-template-empty-photo-page",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["global-nav-view"]:t,{name:"outlet",hash:{},data:i}))+'\n\n<div class="fluid-centered" style="text-align: center;">\n	<h3>'+u((n.intlHTMLMessage||t&&t.intlHTMLMessage||o).call(s,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.TIMEOUT_FAILURE"},data:i}))+"</h3>\n</div>\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["footer-full-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/empty-photo-page",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("empty-photo-page-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return!this.appContext.getViewer().signedIn&&this.appContext.flipper.isFlipped("global-nav-enabled")&&e.push("has-global-nav"),e},buildContainer:function(){return this.setContainerWithTemplate("empty-photo-page"),this}},{ATTRS:{spaceid:{value:792600606}}})},"@VERSION@",{requires:["flickr-view","hermes-template-empty-photo-page","photo-css","util-css","overflow-helper","url","fluid-css"],optional:["global-nav-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-page-lightbox",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(t!=null?t:{},t!=null?t["photo-well-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page-lightbox",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return" no-click"},3:function(e,t,n,r,i){return" is-hidden"},5:function(e,t,n,r,i){return" is-video"},7:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-url"]||(t!=null?t["prev-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-url",hash:{},data:i}):s))},9:function(e,t,n,r,i){return"#"},11:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-title"]||(t!=null?t["prev-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-title",hash:{},data:i}):s))},13:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-url"]||(t!=null?t["next-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-url",hash:{},data:i}):s))},15:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-title"]||(t!=null?t["next-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-title",hash:{},data:i}):s))},17:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return((s=n["if"].call(o,t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-toggle-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-actions-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["attribution-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["people-notes-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"},18:function(e,t,n,r,i){return'	<div class="feedback-widget">\n		<button class="ui-button ui-button-cta ui-button-transparent"><span>Opt-out &amp; Feedback</span></button>\n	</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<a class="navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"  data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n'+e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(o,t!=null?t["photo-well-media-view"]:t,{name:"outlet",hash:{},data:i}))+'\n\n<a class="navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\n'+((s=n.unless.call(o,t!=null?t["is-ad"]:t,{name:"unless",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-reboot-welcome-dialog-content",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"	While we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"},3:function(e,t,n,r,i){return"	Please continue providing us with feedback so we can continue to improve Flickr.\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return"Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n"+((s=n["if"].call(t!=null?t:{},t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"<br>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/reboot-welcome-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-opt-out",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'<form action="//'+f((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s===a?s.call(o,{name:"host",hash:{},data:i}):s))+'/help/optin" method="post">\n	<input type="hidden" name="photo_opt" value="0">\n	<input type="hidden" name="redirect_url" value="'+f((s=(s=n["redirect-url"]||(t!=null?t["redirect-url"]:t))!=null?s:u,typeof s===a?s.call(o,{name:"redirect-url",hash:{},data:i}):s))+'">\n	<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-opt-out",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well-media",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{};return'	<div class="restricted-interstitial">\n		<div class="restricted-interstitial-message">\n			<h2>'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:i}))+"</h2>\n"+((s=n["if"].call(o,t!=null?t.isSignedIn:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+"		</div>\n	</div>\n"},2:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:i}))+"<br />"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:i}))+"</p>\n\n"+((s=n.unless.call(o,t!=null?t.isMinor:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")},3:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return"					<p><button class='ui-button'><span>"+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:i}))+"</span></button></p>\n					<p>"+u((n.intlHTMLMessage||t&&t.intlHTMLMessage||o).call(s,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:i}))+"</p>\n"},5:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:i}))+' <a href="//'+a((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s=="function"?s.call(o,{name:"host",hash:{},data:i}):s))+'/signin/" data-track="photoWellSignInClick">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a></p>\n"},7:function(e,t,n,r,i){var s,o=t!=null?t:{};return"\n"+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")},8:function(e,t,n,r,i){var s;return'		<a class="ad-wrapper" href="'+e.escapeExpression(e.lambda((s=t!=null?t.ad:t)!=null?s.clickUrl:s,t))+'">\n'},10:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isPending:t,{name:"if",hash:{},fn:e.noop,inverse:e.program(11,i,0),data:i}))!=null?s:""},11:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'			<div class="videoplayer main-photo" style="width:'+l((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===f?o.call(u,{name:"width",hash:{},data:i}):o))+"px; height:"+l((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===f?o.call(u,{name:"height",hash:{},data:i}):o))+'px;">'+((s=n["if"].call(u,t!=null?t.isHTML5Video:t,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.noop,data:i}))!=null?s:"")+"</div>\n"},12:function(e,t,n,r,i){var s;return'<video id="video_1" poster="'+e.escapeExpression((s=(s=n.src||(t!=null?t.src:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"src",hash:{},data:i}):s))+'" class="video-js vjs-big-play-centered inherit-size"></video>'},14:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression,l="function";return'\n			<div class="facade-of-protection-neue '+((s=n["if"].call(u,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				'+f((n.outlet||t&&t.outlet||a).call(u,t!=null?t["zoom-view"]:t,{name:"outlet",hash:{},data:i}))+'\n			</div>\n\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.src||(t!=null?t.src:t))!=null?o:a,typeof o===l?o.call(u,{name:"src",hash:{},data:i}):o))+'" class="low-res-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo is-hidden" onload="registerFirstPhoto(this)" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<noscript>\n				<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			</noscript>\n'},15:function(e,t,n,r,i){return"is-video"},17:function(e,t,n,r,i){var s;return'			<span class="ad-info">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{brand:(s=t!=null?t.ad:t)!=null?s.brand:s,intlName:"photo-page-scrappy.FIND_OUT_MORE_AD"},data:i}))+"</span>\n		</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,
n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.needsInterstitial:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-media",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-media-view",function(e,t){var n=require("lib/flog")(t),r=500,i=500,s=100,o;o={photo:{render:function(){var t=this,n=this.get("photo"),r,i,o=new Date,u="";return t.preloadImage&&(t.preloadImage.onload=null),r=this.getPhotoForDisplay(),i=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n.getValue("owner")&&(n.getValue("title").trim()===""?u=this.intlMessage({intlName:"common.UNTITLED"}):u=n.getValue("title"),u+=" | "+this.intlMessage({intlName:"common.BY_USER",user:n.getValue("owner").getValue("username")})),this.setContainerWithTemplate("photo-well-media",{width:r.width,height:r.height,src:i.url,highResSrc:r.url,imgAltText:u,needsInterstitial:n.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:n.getValue("isVideo"),isMinor:this.appContext.getViewer().isMinor,isAd:this.isAd}),this.fire("subviewViewEvent",r),YUI.Env.isServer?(this.serverWidth=r.width,this.serverHeight=r.height):n.getValue("needsInterstitial")||(t.preloadImage=new Image,t.preloadImage.onload=function(){if(this.onloadFired)return;if(!t.isActiveAndInDOM())return;this.onloadFired=!0;var n,i="photoPageShowedSize",u="\u00f8";try{n=/(?:_([a-z]))?\.jpg/.exec(r.url),n&&n[1]&&(u=n[1])}catch(a){}finally{i+=String(u).toUpperCase()}e.rapidTracker.beacon(this.name,i);var f=t.get("container").one(".low-res-photo"),l=t.get("container").one(".main-photo"),c=new Date-o,h;c<s?(l.removeClass("is-hidden").show(),f.hide()):(l.setStyles({position:"absolute",left:0,top:0,opacity:0}),l.removeClass("is-hidden"),h=function(){l.removeAttribute("style"),f.hide()},e.UA.ie?h():e.use("transition",function(e){l.transition({duration:.25,opacity:1},h)}))},t.preloadImage.src=r.url,t.preloadImage.complete&&t.preloadImage.onload()),this}},video:{render:function(){var e=this.get("photo"),t=this.appContext.flipper.isFlipped("enable-html5-video-2016"),n=this.getPhotoForDisplay({excludeSizes:[]});return!this.player||e.getValue("isVideoPending")?(this.setContainerWithTemplate("photo-well-media",{width:n.width,height:n.height,src:n.url,needsInterstitial:e.getValue("needsInterstitial"),isVideo:e.getValue("isVideo"),isHTML5Video:t,isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.fire("subviewViewEvent",n),this):(e.getValue("isVideoPending")||(this.player.dimension&&t?(this.player.dimension("width",n.width),this.player.dimension("height",n.height)):this.player.resize(n.width,n.height)),this)}},ad:{render:function(){var e,t;return this.adJSON?e=this.adJSON:(e=this.appContext.adManager.getAdJSON(),this.adJSON=e),t=this.getAdSize(e),this.setContainerWithTemplate("photo-well-ad",{width:t.width,height:t.height,src:e.url,clickUrl:e.clickUrl,brand:e.brand,adsTypeB:this.appContext.flipper.isFlipped("moneyball-ads-type-b")}),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-scrappy-zoom")},disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then(function(n){t.set("photo",n);if(n.getValue("isVideo"))return new e.Promise(function(t,n){e.use("flickr-video-player",function(){t()})})})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?o.ad.render.call(this):o[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this),this},handleInterstitialDismissButtonClick:function(t){var r=this,i=this.get("personPreferences"),s=this.get("photo"),o=s.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),i.setValue("safeSearch",o),i.registry.remoteUpdate(r.appContext.auth.user.nsid).then(function(e){var t=s.registry.attributeSearch({needsInterstitial:!0});t.forEach(function(e){s.registry.getValue(e,"safetyLevel")<=i.getValue("safeSearch")&&s.registry.setValue(e,"needsInterstitial",!1)}),r.buildContainer()},function(e){n.error({err:e}),r.onError(r.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},activate:function(){var t=this,n=this.getPhotoForDisplay(),r=this.get("container").one(".main-photo"),i,s;return this.get("photo").getValue("isVideo")&&!this.get("photo").getValue("isVideoPending")&&(t.player=new e.FlickrVideoPlayer({container:t.get("container").one(".videoplayer"),model:t.get("photo"),appContext:t.appContext,videoNode:e.one("#video_1")?e.one("#video_1")._node:null,autoplay:!0,loop:!0,controlBar:{fullscreenToggle:!1}}),t.player.init().then(function(){}),t.on("destroy",function(){t.player&&(t.player.destroy(),t.player=null)})),this.get("photo").getValue("needsInterstitial")||(e.use("global-events",function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()}))}),this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),!this.isAd&&(!t.get("clientRendered")||n.width!==Number(r.getAttribute("width"))||n.height!==Number(r.getAttribute("height")))&&t.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",function(n){i=e.Node.create('<div class="note-box"></div>'),s=t.get("container").one(".main-photo").getXY(),t.get("container").append(i),i.setStyles({top:n.noteBoxTop+t.get("container").one(".main-photo").getDOMNode().offsetTop,left:n.noteBoxLeft,width:n.noteBoxWidth,height:n.noteBoxHeight})})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button"
).on("click",t.handleInterstitialDismissButtonClick,t))}),this},onError:function(t){var n=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,classList:"scrappy-dialog"});n.show()},getPhotoForDisplay:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=this.get("photo").getSizeToFit(t,e),i,s;return i=Math.min(t.height/n,r.height),s=Math.min(t.width/n,r.width/r.height*i),i=Math.min(i,r.height/r.width*s),{width:Math.round(s),height:Math.round(i),url:r.url,pixelRatio:r.width/s}},getAdSize:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=80,i=140,s,o;return this.appContext.flipper.isFlipped("moneyball-ads-type-b")&&(t.height-=(r+i)*n,t.width-=i*n),s=Math.min(t.height/n,e.height),o=Math.min(t.width/n,e.width/e.height*s),s=Math.min(s,e.height/e.width*o),{width:o,height:s}},getCanvasSize:function(){var e,t=this.getPixelRatio(),n;return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(n=this.get("container").ancestor(),n&&(e=n.get("region"),e.width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:t})))):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:i,right:r,width:parseInt(this.appContext.getCookie("photoPW"),10)||r,height:parseInt(this.appContext.getCookie("photoPH"),10)||i}),e.height*=t,e.width*=t,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media","moment","hermes-template-photo-well-ad","zoom-view"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-lang-attribution_fr-fr",function(e,t){e.Intl.add("hermes/attribution","fr-FR",{FOLLOW:["Suivre"],FOLLOWING:["Abonn\u00e9"],ERROR_SETTING_FRIEND:["Un probl\u00e8me s\u2019est produit lors de la configuration de votre relation d\u2019ami"],ERROR_SETTING_FAMILY:["Un ",{type:"number",valueName:"POPULATION",format:"integer"},"probl\u00e8me s\u2019est produit lors de la configuration de votre relation d\u2019ami"],FRIEND:["Ami"],FAMILY:["Famille"],UNFOLLOW:["Ne plus suivre"],GO_TO_PHOTOSTREAM:["Acc\u00e9der \u00e0 la galerie de ","${name}"],BY_USER:["Auteur\u00a0: ","${user}"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-head-meta-view",function(e){var t=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{},buildContainer:function(){return this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-head-meta-models",t._params.photoId),t.appContext.getModel("photo-models",t._params.photoId),t.appContext.getModel("photo-privacy-models",t._params.photoId)]).then(function(e){t.set("photo-meta",e[0]),t.set("photo",e[1]),t.set("photo-privacy",e[2])})},buildHeadContainer:function(){var t=this.get("photo-meta"),n=this.get("photo"),r=this.get("photo-privacy"),i=e.url(),s=t.getFieldsForDisplay(),o="",u=this,a=[{id:"canonicalurl",rel:"canonical",href:i+n.getValue("url")},{rel:"alternative",type:"application/json+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=json",title:n.getValue("title")},{rel:"alternative",type:"text/xml+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=xml",title:n.getValue("title")},{rel:"alternative",media:"only screen and (max-width: 640px)",href:"https://m.flickr.com"+encodeURI(n.getValue("url")+"/")}];s["al:ios:url"]||(s["al:ios:url"]="flickr://flickr.com"+n.getValue("url")),o+=this.templates("head-meta")({isName:!0,metaName:"description",metaValue:n.getValue("description")||n.getValue("title")})+"\n";var f="noarchive";return r.getValue("isPublic")||(f+=", noindex"),o+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:f}),o+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:f}),Object.keys(s).forEach(function(e){typeof s[e]=="object"&&e==="pinterest"?o+=u.templates("head-meta")({metaName:e,noPin:!0,metaValue:s[e].nopin,metaDescription:s[e].reason,isName:!0})+"\n":e==="og:description"?o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n":e==="title"?o+=u.templates("head-meta")({isName:!0,metaName:"title",metaValue:s[e]})+"\n":e==="keywords"?o+=u.templates("head-meta")({isName:!0,metaName:e,metaValue:s[e]})+"\n":e==="noindexfollow"?s[e]&&(s[e]>0||s[e]!=="")&&(o+=u.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noindex,follow"})+"\n",o+=u.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noindex,follow"})+"\n"):o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n"}),a.forEach(function(e){e.addedBy=u.name,o+=u.templates("head-link")(e)+"\n"}),this.set("headContainer",o),YUI.Env.isServer||this.updateHead(),this}});return e.mix(t.prototype,e.Seo),t},"@VERSION@",{requires:["flickr-view","hermes-template-head-meta","hermes-template-head-link"],optional:["photo-head-meta-models","photo-route","url","seo"],langBundles:["meta","common","attribution","share-modal"]});
YUI.add("hermes-lang-meta_fr-fr",function(e,t){e.Intl.add("hermes/meta","fr-FR",{PHOTOSTREAM:["Explorez sur Flickr ",{type:"plural",valueName:"photoCount",options:{one:"photo",other:"${#}\u00a0photos"}}," de ","${username}"],PHOTOSTREAM_NO_PHOTOS:["Explorez sur Flickr les photos de ","${username}"],ALBUMS_LIST:["Explorez sur Flickr ",{type:"plural",valueName:"photoCount",options:{one:"album",other:"${#}\u00a0albums"}}," de ","${username}"],ALBUMS_LIST_NO_ALBUMS:["Explorez sur Flickr les albums de ","${username}"],FAVORITES:["Explorez sur Flickr ",{type:"plural",valueName:"photoCount",options:{one:"favori",other:"${#}\u00a0favoris"}}," de ","${username}"],FAVORITES_NO_PHOTOS:["Explorez sur Flickr les favoris de ","${username}"],META_DESCRIPTION_BY_USER_ON_FLICKR:["Par ","${username}"," sur Flickr"],PHOTOSTREAM_ATOM_TITLE:["Flickr\u00a0: Fil RSS Atom de la galerie de photos de ","${username}"],FAVORITES_ATOM_TITLE:["Flickr\u00a0: Fil RSS Atom des favoris de ","${username}"],GROUP_POOL_ATOM_TITLE:["Flickr\u00a0: Fil RSS Atom des photos de ","${groupName}"],GROUP_DISCUSSIONS_ATOM_TITLE:["Flickr\u00a0: Fil RSS Atom des discussions de ","${groupName}"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-page-lightbox-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n=this;return this.backToURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.appContext.experiments.fullscreen.enableFullscreen(),t.realFullscreen=!0,t.isOwner=this.isOwner,this.enableZoom=this.appContext.flipper.isFlipped("enable-scrappy-zoom"),this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one("head title").set("text",n.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),this},subviewConfig:{"photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},buildContainer:function(){var t=this.subviews["photo-well-view"].get("container");return t.addClass("scrappy-photo-page-enabled"),t.addClass("is-real-fullscreen"),this.enableZoom&&t.addClass("enable-zoom"),this.setContainerWithTemplate("photo-page-lightbox",{"photo-well-view":t}),e.fletrics.increment("test.photo.page.requests"),this},activate:function(){return this},closeDialog:function(t){e.config.win.location.href=this.backToURL},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)}},{ATTRS:{spaceid:{value:792600552}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-lightbox","photo-css","util-css","fletrics","ttfp-recorder-plugin","signin-helper","url","fluid-css"],optional:["photo-well-view","photo-head-meta-view"],langBundles:["common","photo-page-scrappy"]});
